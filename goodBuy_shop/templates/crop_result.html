<h2>ä¸Šå‚³åœ–ç‰‡è£åˆ‡å·¥å…·</h2>

<!-- ä¸Šå‚³åœ–ç‰‡è¡¨å–® -->
<form method="post" enctype="multipart/form-data" style="margin-bottom: 30px;">
  {% csrf_token %}
  <input type="file" name="image" accept="image/*" required>
  <button type="submit">é–‹å§‹è£åˆ‡</button>
</form>

<!-- æ¸…ç©ºæŒ‰éˆ• -->
<form method="get">
  <button type="submit" name="clear" value="1" style="background-color: red; color: white;">
    ğŸ”„ æ¸…ç©ºæ‰€æœ‰å·²ä¸Šå‚³èˆ‡å·²è£åˆ‡åœ–ç‰‡
  </button>
</form>

<!-- ä¸‹ä¸€æ­¥ -->
<form method="post" action="{% url 'select_cropped_images' %}">
  {% csrf_token %}
  {% for img in cropped_images %}
    <input type="hidden" name="selected_images" value="{{ img }}">
  {% endfor %}
  <button type="submit" class="btn btn-success mt-3">ä¸‹ä¸€æ­¥ï¼šæ–°å¢å•†å“</button>
</form>

<!-- é¡¯ç¤ºä¸Šå‚³çš„åœ–ç‰‡ -->
{% if uploaded_image %}
  <h3>ä½ ä¸Šå‚³çš„åœ–ç‰‡ï¼š</h3>
  <div style="margin-bottom: 20px;">
    <img src="/upload/{{ uploaded_image }}" width="400">
  </div>
{% endif %}

<!-- è£åˆ‡çµæœèˆ‡åˆªé™¤æŒ‰éˆ• -->
{% if cropped_images %}
  <h3>è£åˆ‡çµæœï¼š</h3>
  <div id="cropped-images">
    {% for img in cropped_images %}
      <div class="cropped-img" id="img-{{ forloop.counter }}" style="display:inline-block; margin:10px;">
        <img src="/upload/{{ img }}" width="200"><br>
        <button type="button" onclick="deleteImage('{{ img }}', 'img-{{ forloop.counter }}')" style="color: red;">âŒ åˆªé™¤</button>
        <p style="font-size: 12px;">{{ img }}</p>
      </div>
    {% endfor %}
  </div>
{% endif %}

<!-- åˆªé™¤åœ–ç‰‡ -->
<script>
function deleteImage(imgPath, elementId) {
  fetch("{% url 'delete_cropped_image' %}", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-CSRFToken": "{{ csrf_token }}",
    },
    body: JSON.stringify({ img: imgPath })
  })
  .then(response => {
    if (response.ok) {
      document.getElementById(elementId).remove();
    } else {
      alert("åˆªé™¤å¤±æ•—");
    }
  });
}
</script>
